{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VMS Pro | Video Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body class="light-mode">
    <div class="container">
        <!-- Sidebar -->
        {% include 'includes/sidebar.html' %}

        <!-- Main Content -->
       <main class="main-content">
        <!-- Header -->
        <header class="header">
            <h2>
                Video Management System
                <span class="live-badge">LIVE</span>
            </h2>
            <div class="header-controls">
                <div class="theme-toggle">
                    <span class="toggle-label">Theme</span>
                    <div class="toggle-switch" id="themeToggle">
                        <i class="fas fa-sun"></i>
                        <i class="fas fa-moon"></i>
                        <span class="toggle-slider"></span>
                    </div>
                </div>
                
                <div class="user-profile">
                    <i class="fas fa-user-circle" style="font-size: 32px; color: var(--primary-color);"></i>
                </div>
            </div>
        </header>

        <!-- Page Header with Add Button -->
        <div class="page-header">
            <h3>Connected Cameras (6)</h3>
            <button class="add-camera-btn" id="addCameraBtn">
                <i class="fas fa-plus-circle"></i>
                Add New Camera
            </button>
        </div>

        <!-- Cameras Section -->
        <div class="camera-section">
            <div class="camera-grid" id="cameraGrid">
                <!-- Camera cards will be generated by JavaScript -->
            </div>
        </div>

        <!-- Empty State (Hidden by default) -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <i class="fas fa-video-slash"></i>
            <p>No cameras added yet</p>
            <p>Click the "Add New Camera" button to get started</p>
        </div>
        
        <!-- Footer -->
        <footer class="footer">
            <p>Â© 2023 VMS Professional. All rights reserved. | Video Management System v4.5 | <span id="cameraCount">6</span> Cameras Connected</p>
        </footer>
    </main>

    <!-- Add Camera Modal -->
    <div class="modal-overlay" id="cameraModal">
        <div class="modal">
            <div class="modal-header">
                <h3>Add New Camera</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="cameraForm">
                    <div class="form-group">
                        <label for="cameraName">Camera Name *</label>
                        <input type="text" id="cameraName" placeholder="e.g. Lobby - Main Entrance" required>
                    </div>

                    <div class="form-group">
                            <label for="brand">Brand *</label>
                           <input type="text" id="camera_brand_name" placeholder="e.g. Camera Brand Name..." required>
                        </div>
                    
                    <div class="form-group">
                        <label for="cameraLocation">IP Address with port *</label>
                        <input type="text" id="cameraLocation" placeholder="e.g. 192.168.1.1:9090" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="username">Username *</label>
                            <input type="text" id="cameraLocation" placeholder="e.g. admin" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="password">Password *</label>
                           <input type="password" id="cameraLocation" placeholder="e.g. password" required>
                        </div>
                    </div>
                    
                    
                   
                    <div class="form-group">
                        <label for="cameraNotes">Additional Notes</label>
                        <textarea id="cameraNotes" rows="3" placeholder="Any additional information about this camera..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelBtn">Cancel</button>
                <button class="btn btn-primary" id="saveCameraBtn" onclick="window.location.reload()">Add Camera</button>
            </div>
        </div>
    </div>

    <script>
        // Sample camera data
        const initialCameras = [
            {
                id: 1,
                name: "Lobby - Main Entrance",
                location: "Building A, Floor 1",
                resolution: "4K",
                fps: "30",
                status: "recording",
                features: ["ai-monitoring", "motion-detection"],
                stats: { type: "people", count: "24" },
                notes: "Main entrance with facial recognition"
            },
            {
                id: 2,
                name: "Parking Lot - North",
                location: "North Parking Area",
                resolution: "1080p",
                fps: "25",
                status: "online",
                features: ["night-vision", "motion-detection"],
                stats: { type: "vehicles", count: "18" },
                notes: "Covers north parking zone"
            },
            {
                id: 3,
                name: "Retail Floor - Zone A",
                location: "Retail Area, Floor 1",
                resolution: "4K",
                fps: "30",
                status: "online",
                features: ["ai-monitoring", "audio-recording"],
                stats: { type: "people", count: "56" },
                notes: "Main retail floor surveillance"
            },
            {
                id: 4,
                name: "Server Room",
                location: "Building B, Basement",
                resolution: "1080p",
                fps: "24",
                status: "online",
                features: ["motion-detection"],
                stats: { type: "devices", count: "42" },
                notes: "Temperature and access monitoring"
            },
            {
                id: 5,
                name: "Warehouse - Loading Bay",
                location: "Warehouse Area",
                resolution: "2K",
                fps: "30",
                status: "offline",
                features: ["night-vision", "ptz-control"],
                stats: { type: "vehicles", count: "8" },
                notes: "Under maintenance until Friday"
            },
            {
                id: 6,
                name: "Executive Floor - Hallway",
                location: "Building A, Floor 10",
                resolution: "4K",
                fps: "30",
                status: "online",
                features: ["ai-monitoring", "motion-detection", "audio-recording"],
                stats: { type: "people", count: "12" },
                notes: "Restricted access area"
            }
        ];

        // State management
        let cameras = [...initialCameras];
        let isDarkMode = false;
        let editingCameraId = null;

        // DOM elements
        const cameraGrid = document.getElementById('cameraGrid');
        const emptyState = document.getElementById('emptyState');
        const cameraCount = document.getElementById('cameraCount');
        const addCameraBtn = document.getElementById('addCameraBtn');
        const cameraModal = document.getElementById('cameraModal');
        const closeModal = document.getElementById('closeModal');
        const cancelBtn = document.getElementById('cancelBtn');
        const saveCameraBtn = document.getElementById('saveCameraBtn');
        const cameraForm = document.getElementById('cameraForm');
        const themeToggle = document.getElementById('themeToggle');

        // Initialize the page
        function init() {
            renderCameras();
            updateCameraCount();
            setupEventListeners();
            
            // Check for saved theme preference
            const savedTheme = localStorage.getItem('vms-theme');
            if (savedTheme === 'dark') {
                enableDarkMode();
            }
        }

        // Render all cameras
        function renderCameras() {
            if (cameras.length === 0) {
                cameraGrid.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            cameraGrid.style.display = 'grid';
            emptyState.style.display = 'none';
            
            cameraGrid.innerHTML = '';
            
            cameras.forEach(camera => {
                const cameraCard = createCameraCard(camera);
                cameraGrid.appendChild(cameraCard);
            });
        }

        // Create a camera card element
        function createCameraCard(camera) {
            const card = document.createElement('div');
            card.className = 'camera-card';
            card.dataset.id = camera.id;
            
            // Get status class
            const statusClass = camera.status === 'recording' ? 'recording' : 
                               camera.status === 'online' ? 'online' : 'offline';
            
            // Get icon based on stats type
            const statIcon = camera.stats.type === 'people' ? 'fa-user-friends' :
                            camera.stats.type === 'vehicles' ? 'fa-car' : 'fa-server';
            
            // Get features text
            const featuresText = camera.features.includes('ai-monitoring') ? 'AI Monitoring' : 
                                camera.features.includes('motion-detection') ? 'Motion Detection' : 
                                camera.status === 'recording' ? 'Recording' : 'Idle';
            
            card.innerHTML = `
                <div class="camera-header">
                    <div class="camera-title">
                        <span class="camera-status ${statusClass}"></span>
                        ${camera.name}
                    </div>
                    <div class="camera-actions">
                        <i class="fas fa-edit" title="Edit Camera"></i>
                        <i class="fas fa-trash" title="Delete Camera"></i>
                        <i class="fas fa-expand" title="Full Screen"></i>
                    </div>
                </div>
                <div class="camera-preview">
                    <i class="fas fa-video"></i>
                    <div class="camera-overlay">${camera.status === 'offline' ? 'OFFLINE' : 'LIVE'}</div>
                </div>
                <div class="camera-info">
                    <div>Resolution: ${camera.resolution} | FPS: ${camera.fps}</div>
                    <div class="camera-stats">
                        <div class="stat">
                            <i class="fas ${statIcon}"></i>
                            <span>${camera.stats.count} ${camera.stats.type}</span>
                        </div>
                        <div class="stat">
                            <i class="fas ${camera.status === 'recording' ? 'fa-history' : 'fa-bell'}"></i>
                            <span>${featuresText}</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Add event listeners to action buttons
            const editBtn = card.querySelector('.fa-edit');
            const deleteBtn = card.querySelector('.fa-trash');
            const expandBtn = card.querySelector('.fa-expand');
            
            editBtn.addEventListener('click', () => editCamera(camera.id));
            deleteBtn.addEventListener('click', () => deleteCamera(camera.id));
            expandBtn.addEventListener('click', () => expandCamera(camera.id));
            
            return card;
        }

        // Update camera count
        function updateCameraCount() {
            cameraCount.textContent = cameras.length;
        }

        // Show add camera modal
        function showAddCameraModal() {
            editingCameraId = null;
            cameraForm.reset();
            document.querySelector('.modal-header h3').textContent = 'Add New Camera';
            document.getElementById('saveCameraBtn').textContent = 'Add Camera';
            cameraModal.classList.add('active');
        }

        // Show edit camera modal
        function showEditCameraModal(camera) {
            editingCameraId = camera.id;
            
            // Populate form with camera data
            document.getElementById('cameraName').value = camera.name;
            document.getElementById('cameraLocation').value = camera.location;
            document.getElementById('cameraResolution').value = camera.resolution;
            document.getElementById('cameraFPS').value = camera.fps;
            document.getElementById('cameraStatus').value = camera.status;
            document.getElementById('cameraNotes').value = camera.notes || '';
            
            // Set features (multiple select)
            const featuresSelect = document.getElementById('cameraFeatures');
            Array.from(featuresSelect.options).forEach(option => {
                option.selected = camera.features.includes(option.value);
            });
            
            document.querySelector('.modal-header h3').textContent = 'Edit Camera';
            document.getElementById('saveCameraBtn').textContent = 'Update Camera';
            cameraModal.classList.add('active');
        }

        // Edit camera
        function editCamera(id) {
            const camera = cameras.find(c => c.id === id);
            if (camera) {
                showEditCameraModal(camera);
            }
        }

        // Delete camera
        function deleteCamera(id) {
            if (confirm('Are you sure you want to delete this camera?')) {
                cameras = cameras.filter(c => c.id !== id);
                renderCameras();
                updateCameraCount();
            }
        }

        // Expand camera view (placeholder function)
        function expandCamera(id) {
            alert(`Expanding view for camera ID: ${id}\nThis would normally open a full-screen camera view.`);
        }

        // Save camera (add or update)
        function saveCamera() {
            // Validate form
            if (!cameraForm.checkValidity()) {
                cameraForm.reportValidity();
                return;
            }
            
            // Get form values
            const name = document.getElementById('cameraName').value;
            const location = document.getElementById('cameraLocation').value;
            const resolution = document.getElementById('cameraResolution').value;
            const fps = document.getElementById('cameraFPS').value;
            const status = document.getElementById('cameraStatus').value;
            const notes = document.getElementById('cameraNotes').value;
            
            // Get selected features
            const featuresSelect = document.getElementById('cameraFeatures');
            const features = Array.from(featuresSelect.selectedOptions).map(option => option.value);
            
            // Determine stats based on location
            let stats;
            if (location.toLowerCase().includes('parking') || location.toLowerCase().includes('lot')) {
                stats = { type: 'vehicles', count: Math.floor(Math.random() * 30) + 5 };
            } else if (location.toLowerCase().includes('server') || location.toLowerCase().includes('data')) {
                stats = { type: 'devices', count: Math.floor(Math.random() * 50) + 10 };
            } else {
                stats = { type: 'people', count: Math.floor(Math.random() * 100) + 10 };
            }
            
            if (editingCameraId) {
                // Update existing camera
                const cameraIndex = cameras.findIndex(c => c.id === editingCameraId);
                if (cameraIndex !== -1) {
                    cameras[cameraIndex] = {
                        ...cameras[cameraIndex],
                        name,
                        location,
                        resolution,
                        fps,
                        status,
                        features,
                        stats,
                        notes
                    };
                }
            } else {
                // Add new camera
                const newCamera = {
                    id: Date.now(), // Simple ID generation
                    name,
                    location,
                    resolution,
                    fps,
                    status,
                    features,
                    stats,
                    notes
                };
                
                cameras.push(newCamera);
            }
            
            // Update UI
            renderCameras();
            updateCameraCount();
            closeCameraModal();
        }

        // Close camera modal
        function closeCameraModal() {
            cameraModal.classList.remove('active');
            cameraForm.reset();
        }

        // Toggle dark mode
        function toggleDarkMode() {
            if (isDarkMode) {
                disableDarkMode();
            } else {
                enableDarkMode();
            }
        }

        // Enable dark mode
        function enableDarkMode() {
            document.body.classList.add('dark-mode');
            isDarkMode = true;
            localStorage.setItem('vms-theme', 'dark');
        }

        // Disable dark mode
        function disableDarkMode() {
            document.body.classList.remove('dark-mode');
            isDarkMode = false;
            localStorage.setItem('vms-theme', 'light');
        }

        // Set up event listeners
        function setupEventListeners() {
            addCameraBtn.addEventListener('click', showAddCameraModal);
            closeModal.addEventListener('click', closeCameraModal);
            cancelBtn.addEventListener('click', closeCameraModal);
            saveCameraBtn.addEventListener('click', saveCamera);
            themeToggle.addEventListener('click', toggleDarkMode);
            
            // Close modal when clicking outside
            cameraModal.addEventListener('click', (e) => {
                if (e.target === cameraModal) {
                    closeCameraModal();
                }
            });
            
            // Handle form submission
            cameraForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveCamera();
            });
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', init);
    </script>
    </div>

    <script src="{% static 'scripts/index.js' %}"></script>
</body>
</html>